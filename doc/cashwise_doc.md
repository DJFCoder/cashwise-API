# üìÑ CashWise ‚Äì Documenta√ß√£o do MVP

**Mais controle, menos desperd√≠cio.**

---

## Sum√°rio

1. [Apresenta√ß√£o](#apresenta√ß√£o)  
2. [Descri√ß√£o do Projeto](#descri√ß√£o-do-projeto)  
3. [Escopo do MVP](#escopo-do-mvp)  
4. [Observa√ß√µes](#observa√ß√µes)  
5. [Necessidades Observadas e Regras de Neg√≥cio](#necessidades-observadas-e-regras-de-neg√≥cio)  
6. [Requisitos Funcionais](#requisitos-funcionais)  
7. [Requisitos N√£o Funcionais](#requisitos-n√£o-funcionais)  
8. [Diagramas UML](#diagramas-uml)  
9. [Conclus√£o](#conclus√£o)  

---

## Apresenta√ß√£o

A **Plataforma de Controle Financeiro Pessoal ‚Äì CashWise** √© um sistema **web full-stack** composto por:

- **Back-end**: Java 17 + Spring Boot 3 ‚Äì API REST  
- **Front-end**: Bootstrap + Alpine.js + jQuery (responsivo, mobile-first)

**Objetivo**: Permitir que o usu√°rio registre receitas/despesas, categorize-as, defina recorr√™ncias e visualize **relat√≥rios financeiros** em dashboards autom√°ticos, sem exporta√ß√£o no MVP.

---

## Descri√ß√£o do Projeto

O usu√°rio registra **lan√ßamentos** informando:
- Valor (em Real ‚Äì BRL)
- Categoria (pr√©-cadastrada)
- Recorr√™ncia (obrigat√≥ria ‚Äì 6 op√ß√µes fixas)
- Data (padr√£o: data atual)
- Descri√ß√£o (obrigat√≥ria)

Os dados s√£o exibidos em **listagens filtr√°veis** e em **p√°gina de relat√≥rios** com gr√°ficos de saldo, evolu√ß√£o mensal e distribui√ß√£o por categoria.

---

## Escopo do MVP

| M√≥dulo | Funcionalidades Entregues |
|--------|---------------------------|
| **Categorias** | CRUD completo. Exclus√£o **s√≥** √© permitida quando **n√£o h√° lan√ßamentos vinculados**. |
| **Lan√ßamentos** | Cadastro, exclus√£o, listagem **paginada** com **8 filtros** (per√≠odo, tipo, categoria, recorr√™ncia, faixa de valor, descri√ß√£o). **Edi√ß√£o N√ÉO existe no MVP**. |
| **Recorr√™ncia** | 6 tipos fixos: `UNIQUE`, `DAILY`, `WEEKLY`, `MONTHLY`, `QUARTERLY`, `ANUAL`.<br>Job di√°rio (01:00) gera **no m√°ximo 2 filhos/dia** respeitando `recurrencyEndDate` e flag `ativo`. |
| **Relat√≥rios** | 3 consultas instant√¢neas: balancete, distribui√ß√£o % por categoria e evolu√ß√£o mensal de um ano. <br>**Sem exporta√ß√£o no MVP**. |

---

## Observa√ß√µes

- Moeda √∫nica: **Real (BRL)**  
- Categorias s√£o **compartilhadas** entre receitas e despesas (simplifica√ß√£o do MVP)  
- Lan√ßamentos com recorr√™ncia ‚â† `UNIQUE` geram **c√≥pias autom√°ticas** (filhos)  
- **Automa√ß√£o**: Job Spring `@Scheduled` processa recorr√™ncias diariamente  
- **Valida√ß√µes**: Bean Validation (`@Valid`) em **todos** os DTOs de entrada  
- **Auditoria**: campos `createdAt`/`updatedAt` preenchidos automaticamente pelo JPA

---

## Necessidades Observadas e Regras de Neg√≥cio

### Necessidades
- Controle **unificado** de receitas e despesas  
- Classifica√ß√£o por **categorias**  
- Relat√≥rios **visuais** para an√°lise r√°pida da situa√ß√£o financeira  

### Regras de Neg√≥cio
RN01. Todo lan√ßamento **deve** estar vinculado a uma **categoria existente**.  
RN02. Valor **> 0** e **‚â§ 9.999.999.999.999,99** (13 inteiros + 2 decimais).  
RN03. Recorr√™ncia √© **obrigat√≥ria** e **fixa** (somente valores do enum).  
RN04. Lan√ßamentos **n√£o podem ser editados** ‚Äì apenas **exclu√≠dos**.  
RN05. Categoria s√≥ √© removida se **nenhum** lan√ßamento estiver associado.  
RN06. Filhos gerados t√™m `recurrencyActive = false` e `parentTransactionId` apontando para o original.  
RN07. Job **n√£o gera mais de 2 filhos por dia** para cada original e **nunca** ap√≥s `recurrencyEndDate`.

---

## Requisitos Funcionais

| ID | Descri√ß√£o |
|----|-----------|
| RF01 | CRUD de **Categorias** (id e nome). Exclus√£o bloqueada se houver lan√ßamentos vinculados. |
| RF02 | CRUD de **Lan√ßamentos** (receitas/despesas). **Edi√ß√£o n√£o permitida** no MVP. |
| RF03 | Selecionar **recorr√™ncia fixa** no lan√ßamento. Se ‚â† `UNICA`, gerar automaticamente lan√ßamentos futuros. |
| RF04 | Listar lan√ßamentos com **filtros** (per√≠odo, tipo, categoria, recorr√™ncia, valor, descri√ß√£o) e **pagina√ß√£o**. |
| RF05 | Visualizar **relat√≥rios web**: Saldo no per√≠odo, Evolu√ß√£o mensal, Distribui√ß√£o por categoria. **Sem exporta√ß√£o no MVP**. |
| RF06 | Registrar **metadados de auditoria** (`createdAt`, `updatedAt`). |
| RF07 | Validar dados de entrada usando **`@Valid`** nos DTOs antes de processar no Controller. |

---

## Requisitos N√£o Funcionais

- **Arquitetura**: Spring Boot (REST) ‚Äì camadas `controller ‚Üí dto ‚Üí service ‚Üí domain ‚Üí repository`  
- **Banco**: MySQL 8+ com Spring JPA (Hibernate) ‚Äì gera√ß√£o de tabelas via `ddl-auto=update`  
- **Valida√ß√£o**: Uso **obrigat√≥rio** de `@Valid` nos DTOs para valida√ß√£o de entradas  
- **Interface**: Responsiva (Bootstrap), mobile-first; acessibilidade b√°sica (aria-labels)  
- **Ambiente**: Localhost:8080 (back-end) e localhost:3000 (front-end)  
- **Compatibilidade**: Chrome/Firefox/Edge atuais  
- **DTO Pattern**: Separados do modelo de dom√≠nio ‚Äì desacoplamento e seguran√ßa de dados  
- **Automa√ß√£o**: Job agendado para processar lan√ßamentos recorrentes (gerar futuros automaticamente)  
- **Integridade**: Valida√ß√£o **obrigat√≥ria** antes de excluir categorias (verificar v√≠nculos)

---

## 7. Diagramas UML

### 7.1 Diagrama de Casos de Uso

```plantuml
@startuml
!theme crt-green
left to right direction

actor "Usu√°rio" as User

rectangle "CashWise" {
  usecase "Gerenciar Categorias" as UC_Cat
  usecase "Registrar Lan√ßamento" as UC_Trans
  usecase "Excluir Lan√ßamento" as UC_Del
  usecase "Aplicar Filtros" as UC_Filter
  usecase "Visualizar Relat√≥rios" as UC_Report
}

User --> UC_Cat
User --> UC_Trans
User --> UC_Del
User --> UC_Filter
User --> UC_Report

UC_Trans .> UC_Filter : <<include>>
UC_Report .> UC_Filter : <<include>>

@enduml
```

### 7.2 Diagrama de Classes

```plantuml
@startuml
!theme crt-green
hide circle
skinparam packageStyle rectangle
skinparam linetype ortho

' === API LAYER ===
package "API" #1a1a1a {
  
  package "Controller" #2d2d2d {
    class CategoriaController {
      + cadastrar(request): ResponseEntity
      + listar(): ResponseEntity
      + excluir(id): ResponseEntity
    }
    
    class LancamentoController {
      + cadastrar(request): ResponseEntity
      + listar(filtro): ResponseEntity
      + excluir(id): ResponseEntity
    }
    
    class RelatorioController {
      + saldoPeriodo(inicio, fim): ResponseEntity
      + evolucaoMensal(ano): ResponseEntity
      + distribuicaoPorCategoria(inicio, fim): ResponseEntity
    }
  }
  
  package "DTO" #2d2d2d {
    class CategoriaRequest {
      - nome: String
      __valida√ß√µes__
      @NotBlank
      @Size(max=120)
    }
    
    class CategoriaResponse {
      - id: Long
      - nome: String
    }
    
    class LancamentoRequest {
      - tipo: String
      - categoriaId: Long
      - valor: BigDecimal
      - data: LocalDate
      - descricao: String
      - recorrencia: String
      __valida√ß√µes__
      @NotNull, @Positive
    }
    
    class LancamentoResponse {
      - id: Long
      - tipo: String
      - categoria: CategoriaResponse
      - valor: BigDecimal
      - data: LocalDate
      - descricao: String
      - recorrencia: String
    }
    
    class FiltroLancamentoRequest {
      - dataInicio: LocalDate
      - dataFim: LocalDate
      - tipo: String
      - categoriaId: Long
    }
  }
  
  package "Mapper" #2d2d2d {
    class CategoriaMapper <<@Component>> {
      + toEntity(request): Categoria
      + toResponse(entity): CategoriaResponse
    }
    
    class LancamentoMapper <<@Component>> {
      + toEntity(request): Lancamento
      + toResponse(entity): LancamentoResponse
    }
  }
}

' === DOMAIN LAYER ===
package "Dominio" #1a4d1a {
  
  class Categoria <<@Entity>> {
    - id: Long
    - nome: String
    - criadoEm: LocalDateTime
    - atualizadoEm: LocalDateTime
  }
  
  class Lancamento <<@Entity>> {
    - id: Long
    - tipo: TipoLancamento
    - valor: BigDecimal
    - data: LocalDate
    - descricao: String
    - recorrencia: TipoRecorrencia
    - categoria: Categoria
    - criadoEm: LocalDateTime
    + isReceita(): boolean
    + isDespesa(): boolean
  }
  
  enum TipoLancamento {
    RECEITA
    DESPESA
  }
  
  enum TipoRecorrencia {
    UNICA
    DIARIA
    SEMANAL
    MENSAL
    TRIMESTRAL
    ANUAL
  }
}

' === SERVICE LAYER ===
package "Servico" #4d4d1a {
  
  class CategoriaServico <<@Service>> {
    + cadastrar(categoria): Categoria
    + excluir(id): void
    + listar(): List<Categoria>
    - verificarVinculo(id): boolean
  }
  
  class LancamentoServico <<@Service>> {
    + cadastrar(lancamento): Lancamento
    + excluir(id): void
    + listar(filtro): Page<Lancamento>
    + gerarRecorrentes(): void
  }
  
  class RelatorioServico <<@Service>> {
    + calcularSaldo(inicio, fim): BigDecimal
    + distribuicaoPorCategoria(inicio, fim): Map
    + evolucaoMensal(ano): Map
  }
}

' === REPOSITORY LAYER ===
package "Repository" #1a1a4d {
  
  interface CategoriaRepository <<@Repository>> {
    + findAll(): List
    + save(entity): Categoria
    + deleteById(id): void
  }
  
  interface LancamentoRepository <<@Repository>> {
    + save(entity): Lancamento
    + deleteById(id): void
    + findAll(spec, page): Page
    + existsByCategoriaId(id): boolean
  }
}

' === JOB LAYER ===
package "Job" #4d1a1a {
  class RecorrenciaJob <<@Scheduled>> {
    - lancamentoServico
    + processar(): void
  }
}

' === RELACIONAMENTOS ===
Lancamento "N" --> "1" Categoria
Lancamento --> TipoLancamento
Lancamento --> TipoRecorrencia

CategoriaController ..> CategoriaServico
CategoriaController ..> CategoriaMapper
LancamentoController ..> LancamentoServico
LancamentoController ..> LancamentoMapper
RelatorioController ..> RelatorioServico

CategoriaMapper ..> Categoria
CategoriaMapper ..> CategoriaRequest
CategoriaMapper ..> CategoriaResponse
LancamentoMapper ..> Lancamento
LancamentoMapper ..> LancamentoRequest
LancamentoMapper ..> LancamentoResponse

CategoriaServico ..> CategoriaRepository
CategoriaServico ..> LancamentoRepository
LancamentoServico ..> LancamentoRepository
RelatorioServico ..> LancamentoRepository

RecorrenciaJob ..> LancamentoServico

@enduml
```

### 7.3 Diagrama EER

```plantuml
@startuml
!theme crt-green

entity "categoria" as CAT {
  * id: BIGINT <<PK>>
  --
  nome: VARCHAR(120) <<NOT NULL>>
  criado_em: DATETIME <<NOT NULL>>
  atualizado_em: DATETIME <<NOT NULL>>
}

entity "lancamento" as LAN {
  * id: BIGINT <<PK>>
  --
  categoria_id: BIGINT <<FK>> <<NOT NULL>>
  tipo: ENUM('RECEITA','DESPESA') <<NOT NULL>>
  recorrencia: ENUM('UNICA','DIARIA','SEMANAL','MENSAL','TRIMESTRAL','ANUAL') <<NOT NULL>>
  data: DATE <<NOT NULL>>
  valor: DECIMAL(15,2) <<NOT NULL>>
  descricao: VARCHAR(255) <<NOT NULL>>
  criado_em: DATETIME <<NOT NULL>>
  atualizado_em: DATETIME <<NOT NULL>>
}

CAT ||--o{ LAN : "classifica"

@enduml
```

**√çndices recomendados para `lancamento`**:
- `idx_lan_data` (data)
- `idx_lan_categoria` (categoria_id)
- `idx_lan_tipo` (tipo)
- `idx_lan_data_tipo` (data, tipo)

---

## 8. Estrutura de Pacotes

```
com.cashwise/
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoriaController.java
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LancamentoController.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RelatorioController.java
‚îÇ   ‚îú‚îÄ‚îÄ dto/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ request/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CategoriaRequest.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LancamentoRequest.java
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ FiltroLancamentoRequest.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ response/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CategoriaResponse.java
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ LancamentoResponse.java
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ RelatorioResponse.java
‚îÇ   ‚îî‚îÄ‚îÄ mapper/
‚îÇ       ‚îú‚îÄ‚îÄ CategoriaMapper.java
‚îÇ       ‚îî‚îÄ‚îÄ LancamentoMapper.java
‚îú‚îÄ‚îÄ domain/
‚îÇ   ‚îú‚îÄ‚îÄ entity/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Categoria.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Lancamento.java
‚îÇ   ‚îî‚îÄ‚îÄ enums/
‚îÇ       ‚îú‚îÄ‚îÄ TipoLancamento.java
‚îÇ       ‚îî‚îÄ‚îÄ TipoRecorrencia.java
‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îú‚îÄ‚îÄ CategoriaRepository.java
‚îÇ   ‚îî‚îÄ‚îÄ LancamentoRepository.java
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ CategoriaServico.java
‚îÇ   ‚îú‚îÄ‚îÄ LancamentoServico.java
‚îÇ   ‚îî‚îÄ‚îÄ RelatorioServico.java
‚îú‚îÄ‚îÄ job/
‚îÇ   ‚îî‚îÄ‚îÄ RecorrenciaJob.java
‚îî‚îÄ‚îÄ CashWiseApplication.java
```

---

## Conclus√£o

O MVP do CashWise entrega todas as funcionalidades essenciais de um controle financeiro pessoal, com automa√ß√£o de recorr√™ncias, relat√≥rios visuais e valida√ß√µes robustas, mantendo simplicidade e prontid√£o para evolu√ß√£o.

### Princ√≠pios de Design

- **KISS** (Keep It Simple, Stupid): Modelo simplificado, sem complexidades desnecess√°rias
- **YAGNI** (You Aren't Gonna Need It): Apenas funcionalidades essenciais para o MVP
- **SOLID**: Principalmente SRP (Single Responsibility Principle) na separa√ß√£o de servi√ßos
- **Object Calisthenics**: Boas pr√°ticas de design orientado a objetos
- **DTO Pattern**: Separa√ß√£o clara entre API externa e modelo de dom√≠nio interno

### Benef√≠cios da Arquitetura

- Desacoplamento total entre camadas ‚Äì permite evoluir modelo de dom√≠nio sem quebrar contratos da API
- Valida√ß√£o espec√≠fica para entradas ‚Äì evita inconsist√™ncias e vazamento de dados internos
- Pagina√ß√£o obrigat√≥ria ‚Äì impede OutOfMemory em grandes volumes
- Job idempotente ‚Äì limite de 2 filhos/dia e uso da √∫ltima data gerada como base elimina duplicidades
- Auditoria autom√°tica ‚Äì rastreabilidade sem c√≥digo extra
- Prontid√£o para escalar ‚Äì API stateless, pronta para containeriza√ß√£o e CI/CD
